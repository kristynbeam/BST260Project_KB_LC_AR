---
title: "KB_Project"
author: "Kristyn Beam"
date: "11/24/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
library(dplyr)
library(lubridate)
```

```{r}
aus_dat <- read.csv("~/Desktop/Project_repo/BST260Project_KB_LC_AR/project_data_files/aus_flu_08_17.csv")
head(aus_dat)
View(aus_dat)
colnames(aus_dat)

rename(aus_dat, week = Week.Ending..Friday.)
rename(aus_dat, age_group = Age..group)

aus_dat <- aus_dat %>% 
  rename(week = Week.Ending..Friday., age_group = Age..group, indig = Indigenous.status, flu_type = Type.Subtype)

aus_dat <- aus_dat %>% 
  select(week, State, age_group, Sex, indig, flu_type)

#Changing to date and character vectors
aus_dat$week <- mdy(aus_dat$week)
aus_dat$flu_type <- as.character(aus_dat$flu_type)
aus_dat$State <- as.character(aus_dat$State)
aus_dat$Sex <- as.character(aus_dat$Sex)

head(aus_dat)
```


```{r}
aus_dat_case <- aus_dat %>% 
  group_by(week, State, age_group, Sex, flu_type) %>% 
  summarize(n_cases = n())

```

```{r}
aus_data <- read.csv( "~/Desktop/Project_repo/BST260Project_KB_LC_AR/project_data_files/Australian_data_clean.csv")
not_all_na <- function(x) any(!is.na(x))
aus_data<-aus_data%>%select_if(not_all_na)%>% rename("Disease"="X")

#Rate per 100,000
head(aus_data)

aus_data_cases<- aus_data %>% select("Disease":"Aust_n")%>% rename("ACT"="ACT_n", "NSW"="NSW_n", "NT"="NT_n", "Qld"="Qld_n", "SA"="SA_n", "Tas"= "Tas_n", "Vic"= "Vic_n", "WA"= "WA_n", "Australia"= "Aust_n")%>% arrange("Month") %>% gather(State, Cases, c("ACT":"Australia"))


aus_data_rates<-aus_data %>% select("Disease"|"Date"|"ACT_rate":"Aust_rate")%>% rename("ACT"="ACT_rate", "NSW"="NSW_rate", "NT"="NT_rate", "Qld"="Qld_rate", "SA"="SA_rate", "Tas"= "Tas_rate", "Vic"= "Vic_rate", "WA"= "WA_rate", "Australia"= "Aust_rate")%>% arrange("Month") %>% gather(State, Rates, c("ACT":"Australia")) 

aus_total<-left_join(aus_data_cases, aus_data_rates)

aus_total$Date<-mdy(aus_total$Date)
aus_total$Cases<-as.numeric(aus_total$Cases)
aus_total$Rates<-as.numeric(aus_total$Rates)
head(aus_total)
```

```{r}
library (ggplot2)

aus_total_covid<-aus_total %>% filter (Disease=="COVID-19")

p<-ggplot(data=aus_total_covid, aes(Date, Cases))
p+geom_line(aes(color=State)) +
  ggtitle("Covid Cases by Region") +
  ylim(0, 70000)

p2<-ggplot(data=aus_total_covid, aes(Date, Rates))
p2+geom_line(aes(color=State)) +
  ggtitle("Covid Rates by Region") +
  ylim(0, 450)

aus_total_influenza<-aus_total %>% filter (Disease=="Influenza (laboratory confirmed)")

p3<-ggplot(data=aus_total_influenza, aes(Date, Cases))
p3+geom_line(aes(color=State)) +
  ggtitle("Influenza Cases by Region") +
  ylim(0, 70500)

p4<-ggplot(data=aus_total_influenza, aes(Date, Rates))
p4+geom_line(aes(color=State)) +
  ggtitle("Influenza Rate by Region") +
  ylim(0, 450)

```


```{r}
#Read in policy data
pol_dat <- read.csv("~/Desktop/Project_repo/BST260Project_KB_LC_AR/project_data_files/coronanet_release.csv")
head(pol_dat)

#Filtered policy data to just Australia
pol_dat_aus <- pol_dat %>% 
  filter(ISO_A2 == "AU" & ISO_A3 == "AUS") %>% 
  arrange(date_start)

#Read in uid lookup dataset
countries <- read.csv("~/Desktop/Project_repo/BST260Project_KB_LC_AR/project_data_files/UID_ISO_FIPS_LookUp_Table.csv")
head(countries)
countries <- countries %>% 
  rename(ISO_A2 = iso2, ISO_A3 = iso3)

countries %>% 
  filter(ISO_A3 == "AUS")

#Filtered australia policy data to include columns of significance
pol_dat_aus <- pol_dat_aus %>% 
  select(description, date_announced, date_start, date_end, country, ISO_A2, ISO_A3, domestic_policy, province, type, type_sub_cat, type_text, target_country, target_province, target_who_what, compliance, enforcer) %>% 
  group_by(date_announced) %>% 
  arrange(province)

```

